{% extends "base.html" %}

{% block head %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/planner.css') }}" type="text/css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/plannerCalendarArea.css') }}" type="text/css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/plannerEventsArea.css') }}" type="text/css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/plannerGroupsArea.css') }}" type="text/css">
{% endblock %}

{% block title %}Planner{% endblock %}

{% block content %}
    <main class="planner-interface">
        <div class="planner-header">
            <h1 class="planner-title">Planner</h1>
            <nav class="view-selector glassy">
                <button class="view-tab active" id="groups-tab">Groups</button>
                <button class="view-tab" id="calendar-tab">Calendar</button>
                <button class="view-tab" id="events-tab">Events</button>
                <button class="view-tab">Insights</button> {# Add ID if needed later #}
            </nav>
        </div>

        <div class="planner-pane" id="planner-pane">

            <!-- Left Side: Group List (Generated by Jinja) -->
            <aside class="group-list-area">
                 <div class="mobile-list-header"></div>
                 <ul>
                    {% if groups %}
                        {% for group in groups %}
                        <li class="group-item {% if loop.first and not is_mobile_on_load %}active{% endif %}" {# Only activate first on desktop load #}
                            data-group-id="{{ group.id | e }}"
                            data-group-name="{{ group.name | e }}"
                            data-group-avatar="{{ group.avatar_url | e }}">
                            <img src="{{ group.avatar_url | e }}" alt="{{ group.name | e }} Avatar" class="group-avatar">
                            <div class="group-info">
                                <span class="group-name">{{ group.name | e }}</span>
                                <span class="group-stats">{{ group.upcoming_event_count }} upcoming event{{ 's' if group.upcoming_event_count != 1 else '' }}</span>
                            </div>
                        </li>
                        {% endfor %}
                    {% else %}
                        <li>No groups found.</li>
                    {% endif %}
                 </ul>
            </aside>

            <!-- Right Side: Event Area (Content managed by JS) -->
            <section class="event-collage-area" id="event-collage">
                {# Blur wrapper and header remain, content updated by JS #}
                <div class="blur-wrapper">
                    <div class="blur-overlay"></div>
                    <div class="active-group-header glassy">
                        <button class="icon-button back-button" aria-label="Back to groups">←</button>
                        {# Initial state set by JS #}
                        <img src="" alt="Active Group Avatar" class="group-avatar-small" id="active-group-avatar">
                        <span class="active-group-name" id="active-group-name">Select a Group</span>
                        <button class="icon-button settings-button">⚙️</button>
                    </div>
                </div>
                {# NEW: Viewport for panning the collage content #}
                <div class="collage-viewport" id="collage-viewport">
                     {# Container for absolutely positioned items (nodes & events) #}
                    <div class="event-panels-container" id="event-panels-container">
                        <!-- Nodes and Event panels will be loaded here by JS -->
                    </div>
                    {# Optional: Controls for adding nodes - Positioned absolutely #}
                    <div class="node-controls" style="position: absolute; top: 10px; left: 10px; z-index: 100;">
                        <button id="add-node-btn" class="button accept" style="padding: 8px 12px; font-size: 0.9em; display: none;">Add Node</button> {# Hide initially #}
                    </div>
                </div>
            </section>

            <!-- Calendar View Area (Structure remains, content by JS) -->
            <section class="calendar-view" id="calendar-view">
                <div class="calendar-header">
                    <button class="calendar-nav prev-month" id="calendar-prev-month"><</button>
                    <h2 class="calendar-month-year" id="calendar-month-year">Month Year</h2>
                    <button class="calendar-nav next-month" id="calendar-next-month">></button>
                </div>
                <div class="calendar-days-header">
                    <span>Sun</span><span>Mon</span><span>Tue</span><span>Wed</span><span>Thu</span><span>Fri</span><span>Sat</span>
                </div>
                <div class="calendar-grid" id="calendar-grid">
                    <!-- Calendar cells generated by JS -->
                </div>
            </section>

            <!-- Events List View Area (Structure remains, content by JS) -->
            <section class="events-view" id="events-view">
                <nav class="event-filter-bar glassy" id="event-filter-bar">
                    <button class="filter-pill active" data-filter="upcoming">Upcoming</button>
                    <button class="filter-pill" data-filter="past">Past</button>
                    <button class="filter-pill" data-filter="all">All</button>
                </nav>
                <div class="event-list-container" id="event-list-container">
                    <!-- Event tiles generated by JS -->
                </div>
            </section>

        </div> <!-- End of planner-pane -->

         <!-- Add somewhere convenient, maybe below the planner pane -->
        <div style="padding: 15px; text-align: center; background: rgba(0,0,0,0.3); margin-top: 10px; border-radius: 8px;">
            <button id="add-group-btn" class="button accept">Add Demo Group</button>
            <button id="add-event-btn" class="button accept" style="margin-left: 10px;">Add Demo Event to Active Group</button>
        </div>
    </main>

    <script type="module" src="{{ url_for('static', filename='js/main.js') }}"></script>
    <div id="custom-context-menu" class="context-menu" style="display: none;"></div>
{% endblock %}